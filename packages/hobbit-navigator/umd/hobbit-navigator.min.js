!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("path-to-regexp"),require("mithril")):"function"==typeof define&&define.amd?define(["path-to-regexp","mithril"],e):t.HobbitNavigator=e(null,t.Mithril)}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},r={hashbanged:!1,location:null,hashbangPrefix:"#!"},a=function(t){return void 0!==t&&t.document?!(!t.history||!t.history.pushState)||(console.warn("It seems you are not using a browser with HTML5 history\n            support. Hobbit-navigator will cause the page to refresh rather\n            than navigate smoothly. Use a polyfil to prevent this issue."),!1):(console.warn("The history API for hobbit-navigator was executed on the\n            server, if this is an expected bahavior (For example, when using SSR),\n            set the location manually to display the intended content."),!1)},s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e),this.configuration=Object.assign({},r,t),this.supported=a(window);var i=this.configuration,s=i.hashbanged,c=i.hashbangPrefix,h=i.location;h?this.location="object"===(void 0===h?"undefined":n(h))?h:{path:h,url:""+(s?c:"")+h,pattern:h,params:{},sender:""}:this.setLocationFromHref(),s&&window.addEventListener("hashchange",this.setLocationFromHref.bind(this))}return e.prototype.setLocationFromHref=function(){var t=this.configuration,e=t.hashbanged,n=t.hashbangPrefix,o=document.createElement("a");o.href=window.location.href;var i=e?o.hash.replace(n,""):o.pathname;this.location={path:i.startsWith("/")?i:"/"+i,url:e?o.hash:o.pathname,pattern:i.startsWith("/")?i:"/"+i,params:this.getState(),sender:""}},e.prototype.getLocation=function(){return this.location},e.prototype.getState=function(){return window.history.state||{}},e.prototype.extractParams=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.loose,o=void 0!==n&&n,i=e.caseSensitive,r=void 0===i||i,a=e.strict,s=void 0!==a&&a,c=this.executePattern(this.location.path,t,{end:!o,sensitive:r,strict:s}),h=c.match,u=c.keys;if(null===h)return null;var d=h.slice(1);return u.reduce(function(t,e,n){return t[e.name]=d[n],t},{})},e.prototype.executePattern=function(e,n,o){var i=[];return{keys:i,match:t(n,i,o).exec(e)}},e.prototype.navigate=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.params,i=void 0===o?{}:o,r=n.sender,a=void 0===r?"":r,s=n.force,c=void 0!==s&&s,h=n.options,u=(void 0===h?{}:h).replace||!1,d=t.compile(e)(i);(c||d!==this.location.path)&&this.navigatePure(d,i,{sender:a,replace:u,pattern:e})},e.prototype.navigatePure=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.sender,i=void 0===o?"":o,r=n.replace,a=void 0!==r&&r,s=n.pattern,c=this.configuration,h=c.hashbanged,u=c.hashbangPrefix,d=""+(h?u:"")+t;if(s||(s=t),this.location={path:t,pattern:s,url:d,sender:i,params:e},this.supported)a?window.history.replaceState(e,null,d):window.history.pushState(e,null,d);else{if(a)return void console.warn("The replace option is not available for browsers not\n                supporting the HTML5 history API.");window.location.href=d}},e.prototype.compare=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.loose,o=void 0!==n&&n,i=e.caseSensitive,r=void 0===i||i,a=e.strict,s=void 0!==a&&a,c=this.executePattern(this.location.path,t,{end:!o,sensitive:r,strict:s}).match;if(!c)return!1;var h=c[0];return!!o||new RegExp(this.location.path,r?"":"i").test(h)},e}(),c=void 0,h={oncreate:function(){window.addEventListener("hashchange",this.redrawNode.bind(this))},onremove:function(){window.removeEventListener("hashchange",this.redrawNode.bind(this))},redrawNode:function(){e.redraw()},view:function(t){return t.children}},u=function(t,o,r){if(!c)throw"The router was not initialized using 'createRouter'\n            before trying to render a route.";if(void 0===t)throw"The 'r' function expects at least one argument";var a;for(var s in o&&o.hasOwnProperty("tag")?((a={})[t]=o,t=a,"object"===(void 0===r?"undefined":n(r))&&(r=r)):"object"===(void 0===o?"undefined":n(o))&&(r=o),t){var u=t[s];if(c.compare(s,r)){if("object"===(void 0===u?"undefined":n(u))&&u.tag&&"function"==typeof u.tag.view)return e(h,[Object.assign({},u,{attrs:i({},u.attrs,{location:Object.assign({},c.getLocation(),{params:c.extractParams(s,r)}),params:Object.assign({},c.getState(),c.extractParams(s,r))})})]);if("object"===(void 0===u?"undefined":n(u))&&u.tag)return e(h,[u])}}return null};return u.createRouter=function(t){c=new s(t)},u._resetRouter=function(){c=void 0},u.getLocation=function(){if(!c)throw"The router was not initialized using 'createRouter'\n            before trying to get the router's location.";return c.getLocation()},u.navigate=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!c)throw"The router was not initialized using 'createRouter'\n            before trying to navigate to a route.";c.navigate(t,Object.assign({},{params:e},n))},u.withLocation=function(t,n,o){return{view:function(r){if(!c)throw"The router was not initialized using 'createRouter'\n                    before trying to to subscribe to location in a component.";return e(n,i({},r.attrs,{location:Object.assign({},c.getLocation(),{params:c.extractParams(t,o)}),params:Object.assign({},c.extractParams(t,o))}))}}},u});
